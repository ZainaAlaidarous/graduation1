<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>تأكيد حضور الحفل</title>
  <style>
    body{font-family:Arial,sans-serif;text-align:center;margin-top:40px}
    .card{margin:20px auto;padding:20px;border:1px solid #ddd;border-radius:12px;max-width:520px}
    input,button{padding:10px;margin:8px;font-size:16px}
    #submitBtn{display:none;background:#2563eb;color:#fff;border:none;border-radius:8px;cursor:pointer}
    .member{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:12px 0;padding:10px;border-radius:10px;background:#fafafa;border:1px solid #eee}
    .name{font-weight:600}
    .status{min-width:110px;text-align:center}

    /* ===== CSS Switch (checkbox styled) ===== */
    .switch{
      position:relative;width:70px;height:34px;flex-shrink:0
    }
    .switch input{
      opacity:0;width:0;height:0;position:absolute
    }
    .slider{
      position:absolute;inset:0;background:#e5e7eb;border-radius:999px;transition:.25s ease;
      box-shadow: inset 0 0 0 2px #d1d5db;
    }
    .slider:before{
      content:"";position:absolute;height:26px;width:26px;left:4px;top:4px;background:#ef4444;border-radius:50%;
      transition:.25s ease;
    }
    /* ON state */
    input:checked + .slider{
      background:#d1fae5;box-shadow: inset 0 0 0 2px #34d399;
    }
    input:checked + .slider:before{
      transform:translateX(36px);background:#22c55e;
    }
    /* Labels YES/NO text */
    .switch .off, .switch .on{
      position:absolute;top:50%;transform:translateY(-50%);font-size:12px;font-weight:700;pointer-events:none;
    }
    .switch .off{left:8px;color:#9ca3af}
    .switch .on{right:8px;color:#059669;opacity:0;transition:.2s}
    input:checked ~ .on{opacity:1}
    input:checked ~ .off{opacity:0}
  </style>
</head>
<body>
  <h2>🎉 تأكيد حضور الحفل</h2>

  <div class="card">
    <label>اكتب اسمك:</label><br>
    <input id="nameInput" type="text" placeholder="مثال: الأم" />
    <button onclick="checkGuest()">متابعة</button>

    <div id="guestList"></div>

    <button id="submitBtn" onclick="submitResponse()">إرسال</button>
    <div id="result" style="margin-top:14px"></div>
  </div>

  <script>
    // بيانات المجموعات: الاسم الرئيسي => قائمة الأفراد
    const groups = {
      "الأم": ["الأم","محمد","سارة"],
      "الأب": ["الأب","أحمد"]
    };

    let currentMembers = [];
    let responses = {}; // person -> true/false

    function checkGuest(){
      const key = document.getElementById('nameInput').value.trim();
      const box = document.getElementById('guestList');
      const result = document.getElementById('result');
      const submit = document.getElementById('submitBtn');

      box.innerHTML = "";
      result.innerHTML = "";
      submit.style.display = "none";
      responses = {};
      currentMembers = [];

      if(!groups[key]){
        box.innerHTML = `<p>❌ الاسم غير موجود في قائمة المدعوين.</p>`;
        return;
      }

      currentMembers = groups[key];
      box.innerHTML = `<p>✅ تم العثور على <b>${key}</b> — عدد المدعوين: ${currentMembers.length}</p>`;

      // إنشاء صف لكل شخص مع سويتش
      currentMembers.forEach(person=>{
        responses[person] = null; // لم يُحدد بعد

        const row = document.createElement('div');
        row.className = 'member';

        const nameEl = document.createElement('div');
        nameEl.className = 'name';
        nameEl.textContent = person;

        const statusEl = document.createElement('div');
        statusEl.id = `status-${person}`;
        statusEl.className = 'status';
        statusEl.textContent = '⏳ بانتظار الاختيار';

        const switchWrap = document.createElement('label');
        switchWrap.className = 'switch';

        const cb = document.createElement('input');
        cb.type = 'checkbox';
        cb.setAttribute('aria-label', `تبديل حضور ${person}`);
        cb.addEventListener('change', e=>{
          responses[person] = e.target.checked; // true=يحضر, false=لا
          statusEl.textContent = e.target.checked ? '✅ سيحضر' : '❌ لن يحضر';
          // زر الإرسال يظهر فقط بعد تحديد الكل
          const allChosen = Object.values(responses).every(v=>v !== null);
          if(allChosen) submit.style.display = 'inline-block';
        });

        const slider = document.createElement('span');
        slider.className = 'slider';

        const offTxt = document.createElement('span');
        offTxt.className = 'off';
        offTxt.textContent = 'لا';

        const onTxt = document.createElement('span');
        onTxt.className = 'on';
        onTxt.textContent = 'نعم';

        switchWrap.appendChild(cb);
        switchWrap.appendChild(slider);
        switchWrap.appendChild(offTxt);
        switchWrap.appendChild(onTxt);

        row.appendChild(nameEl);
        row.appendChild(switchWrap);
        row.appendChild(statusEl);
        box.appendChild(row);
      });
    }

   function submitResponse(){
  const result = document.getElementById('result');
  const attending = [];
  const notAttending = [];

  for(const [person, val] of Object.entries(responses)){
    (val ? attending : notAttending).push(person);
  }

  // عرض النتيجة للمستخدم
  let html = "<h3>📋 نتائج التأكيد</h3>";
  html += attending.length ? `✅ <b>الحاضرون:</b> ${attending.join("، ")}<br>` : "";
  html += notAttending.length ? `❌ <b>غير الحاضرين:</b> ${notAttending.join("، ")}<br>` : "";
  html += "<br>🎉 شكرًا تم تسجيل ردكم!";
  result.innerHTML = html;

  // ---- إرسال البيانات إلى Formspree ----
  fetch("https://formspree.io/f/xdkdrgjo", { 
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      الاسم: document.getElementById("nameInput").value,
      الحاضرون: attending.join("، "),
      الغائبون: notAttending.join("، ")
    })
  })
  .then(r => {
    if(r.ok){
      console.log("✅ تم إرسال الرد إلى Formspree");
    } else {
      console.error("❌ خطأ أثناء الإرسال");
    }
  });
}

  </script>
</body>
</html>
